#!/usr/bin/env ruby
# frozen_string_literal: true

require "open-uri"
require "json"

urls = %w[
  https://raw.githubusercontent.com/ivolo/disposable-email-domains/master/index.json
  https://raw.githubusercontent.com/andreis/disposable-email-domains/master/domains.json
  https://raw.githubusercontent.com/FGRibreau/mailchecker/master/list.txt
  https://raw.githubusercontent.com/willwhite/freemail/master/data/disposable.txt
]

domains = urls.each_with_object([]) do |url, buffer|
  ext = File.extname(url)

  result = case ext
           when ".json"
             JSON.parse(URI.open(url).read)
           when ".txt"
             URI.open(url).read.lines.map(&:chomp)
           else
             raise "Unknown extension"
           end

  buffer.push(*result)
end

domains.map!(&:downcase)
domains.uniq!
domains.sort!

File.open("./data/disposable.json", "w") do |file|
  file << JSON.pretty_generate(domains)
end
