#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "helpers"

tlds = http_request(:get, "https://data.iana.org/TLD/tlds-alpha-by-domain.txt").body.lines
tlds.shift # remove update notice

tlds.map!(&:downcase)
tlds.map!(&:strip)
tlds.map! {|tld| SimpleIDN.to_ascii(tld) }

save_file("tld.json", tlds)

country_tlds = JSON.parse(http_request(:get, "https://github.com/samayo/country-json/raw/master/src/country-by-domain-tld.json").body, symbolize_names: true)
country_tlds = country_tlds
               .reject {|info| info[:tld].nil? }
               .map {|info| info[:tld].gsub(/^\./, "") }

save_file("country_tlds.json", country_tlds)
